<div *ngIf="first" class="flex justify-content-center">
  <h3><b>{{'MENU.FREQUENCY' | translate}}</b></h3>
</div>
<div *ngIf="!first" class="flex justify-content-center">
  <h3><b>&nbsp;</b></h3>
</div>
<p-progressSpinner *ngIf="loading" [style]="{width: '50px', height: '50px'}" animationDuration=".5s"
  class="flex align-items-center">
</p-progressSpinner>
<p-table [ngClass]="{'hidden': (!visible || noResultFound) && !loading}" [value]="lines" [lazy]="true"
  (onLazyLoad)="loadFrequencies($event)" [paginator]="true" [rows]="10" [rowsPerPageOptions]="paginations"
  [totalRecords]="totalItems" [customSort]="true" currentPageReportTemplate="'page: {currentPage} of {totalPages}'"
  [showCurrentPageReport]="true" [sortField]="sortField" [sortOrder]="-1" [autoLayout]="true">
  <ng-template pTemplate="header">
    <tr>
      <th>
        <button pButton (click)="showDialog(category)" [disabled]="loading">CSV</button>
        <p-dialog header="File Csv in elaborazione" [(visible)]="dlgVisible" [modal]="true" [closable]="false"
          [style]="{width: '15vw'}">
          <div class="flex justify-content-center mb-2">
            <p-progressBar *ngIf="dlgVisible" style="width: 100%;" [value]="progressStatus" tooltipPosition="bottom"
              [pTooltip]="'' + progressStatus">
            </p-progressBar>

          </div>
          <div class="flex justify-content-center">
            <p-progressSpinner [style]="{width: '30px', height: '30px'}"></p-progressSpinner>
          </div>
          <p>
            Attendere il completamento dell'operazione.<br> Non uscire e non aggiornare la pagina.
          </p>
        </p-dialog>
      </th>
      <th *ngIf="!multilevel" class="text-right" pSortableColumn="0">{{category}}</th>
      <th class="text-right" *ngFor="let col of colHeaders; let idx = index" [pSortableColumn]="col+'-'+idx">{{col |
        translate}}
        <p-sortIcon [field]="col+'-'+idx"></p-sortIcon>
      </th>
      <th class="text-right">{{'PAGE.FREQUENCY.ITEMS' | translate}}: {{totalItems}} -
        {{'PAGE.FREQUENCY.TOTAL_FREQ' | translate}}: {{totalFrequency}}</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-line>
    <tr *ngIf="line" [ngClass]="{'hidden': loading}">
      <td> <button pButton (click)="clickPN(line, true)" class="p-button-link p-n-button" label="P"></button> | <button
          pButton (click)="clickPN(line, false)" class="p-button-link p-n-button" label="N"
          [disabled]="colHeaders.length > 2"></button></td>
      <td *ngIf="multilevel && colHeaders.length >= 2" class="text-right">{{line.word[0]}}</td>
      <td *ngIf="!multilevel" class="text-right"><a href="http://{{line.word[0]}}" target="_blank">{{line.word[0]}}</a>
      </td>
      <td *ngIf="multilevel && colHeaders.length >= 3" class="text-right">{{line.word[1]}}</td>
      <td *ngIf="multilevel && colHeaders.length >= 4" class="text-right">{{line.word[2]}}</td>
      <td *ngIf="multilevel && colHeaders.length >= 5" class="text-right">{{line.word[3]}}</td>
      <td class="text-right">{{line.freq}}</td>
      <td *ngIf="!multilevel" class="text-right">{{line.rel}}</td>
      <td>
        <p-progressBar *ngIf="multilevel" [value]="(line.freq / maxFreq) * 100" [showValue]="false"
          tooltipPosition="bottom" pTooltip="{{'PAGE.FREQUENCY.FREQUENCY' | translate}}: {{line.freq}}">
        </p-progressBar>
        <p-progressBar *ngIf="!multilevel" [value]="(line.freq / maxFreq) * 100" [showValue]="false"
          tooltipPosition="bottom" pTooltip="{{'PAGE.FREQUENCY.FREQUENCY' | translate}}: {{line.freq}}">
        </p-progressBar>
        <span class="flex mt-1"></span>
        <p-progressBar *ngIf="!multilevel" [value]="(line.rel / maxRel) * 100" [showValue]="false"
          tooltipPosition="bottom" [style]="{'height': '10px'}"
          pTooltip="{{'PAGE.FREQUENCY.REL' | translate}}: {{line.rel}}">
        </p-progressBar>
      </td>
    </tr>
  </ng-template>
</p-table>
<div class="mt-3 w-12" *ngIf="visible && noResultFound && !loading">
  <h3 style="text-align: center;" class="text-red">{{"PAGE.NO_RESULT_FOUND" | translate}}</h3>
</div>
