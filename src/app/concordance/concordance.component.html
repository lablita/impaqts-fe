<div class="flex flex-row">

  <div class="flex flex-grow-1 flex-column mt-3">
    <p-card
      [ngClass]="{'w-12': displayPanelService.displayPanelMetadata || displayPanelService.displayPanelOptions, 'w-6': !(displayPanelService.displayPanelMetadata || displayPanelService.displayPanelOptions)}">
      <div class="mb-3">
        <label class="mr-3">{{"PAGE.CONCORDANCE.CORPUS" | translate}}</label>
        <p-dropdown [options]="corpusList" [(ngModel)]="selectedCorpus" optionLabel="value" [filter]="true"
          [showClear]="true" placeholder="{{selectCorpus}}" (onChange)="dropdownCorpus()">
          <ng-template pTemplate="selectedItem">
            <div *ngIf="selectedCorpus">
              <div class="">{{selectedCorpus.value}}</div>
            </div>
          </ng-template>
          <ng-template let-country pTemplate="item">
            <div>
              <div class="">{{country.value}}</div>
            </div>
          </ng-template>
        </p-dropdown>
      </div>
      <div class="p-field mb-3">
        <label for="simple_query" class="label-size mr-3">
          {{"PAGE.CONCORDANCE.SIMPLE_QUERY" | translate}}
        </label>
        <input id="simple_query" type="text" pInputText style="width: 350px;" [(ngModel)]="simple">
        &nbsp;
        <button [disabled]="!selectedCorpus" pButton type="button" icon="pi"
          label="{{'PAGE.CONCORDANCE.MAKE_CONCORDANCE' | translate}}" (click)="makeConcordances()"></button>
      </div>
      <div class="flex justify-content-center">
        <button [requiredRole]="['ADMIN', 'ADVANCEDUSER']" pButton type="button" icon="pi"
          label="{{'PAGE.CONCORDANCE.QUERY_TYPES' | translate}}" [disabled]="!selectedCorpus" class="p-button-text mr-3"
          (click)="clickQueryType()"></button>&nbsp;
        <button pButton type="button" icon="pi" label="{{'PAGE.CONCORDANCE.CONTEXT' | translate}}"
          [disabled]="!selectedCorpus" class="p-button-text" (click)="clickContext()"></button>&nbsp;
      </div>

      <div class="mt-3" *ngIf="queryTypeStatus">
        <div class="">
          <label class="mb-3">
            <h2>{{"PAGE.CONCORDANCE.QUERY_TYPE" | translate}}</h2>
          </label>
          <div class="flex justify-content-center">
            <div *ngFor="let queryType of queryTypes" class="p-field-checkbox">
              <p-radioButton class="ml-3 mr-1" [inputId]="queryType.key" name="queryType" [value]="queryType"
                [(ngModel)]="selectedQueryType">
              </p-radioButton>
              <label class="mr-3" [for]="queryType.key" class="">{{queryType.value}}</label>
            </div>
          </div>
        </div>
        <div class="mt-3 p-field" *ngIf="selectedQueryType && selectedQueryType.key === LEMMA">
          <label class="mr-3" for="lemma">{{"PAGE.CONCORDANCE.LEMMA" | translate}}</label>
          <input id="lemma" type="text" pInputText style="width: 350px;" [(ngModel)]="lemma">
        </div>
        <div class="mt-3 p-field" *ngIf="selectedQueryType && selectedQueryType.key === PHRASE">
          <label class="mr-3" for="phrase">{{"PAGE.CONCORDANCE.PHRASE" | translate}}</label>
          <input id="phrase" type="text" pInputText style="width: 350px;" [(ngModel)]="phrase">
        </div>
        <div class="flex mt-3 p-field" *ngIf="selectedQueryType && selectedQueryType.key === WORD">
          <label class="mr-3 pt-2" for="word">{{"PAGE.CONCORDANCE.WORD_FORM" | translate}}</label>
          <input class="mr-6" id="word" type="text" pInputText style="width: 350px;" [(ngModel)]="word">
          <p-checkbox name="iconForOne" [binary]="true" label="{{'PAGE.CONCORDANCE.MATCH_CASE' | translate}}"
            [(ngModel)]="matchCase">
          </p-checkbox>
        </div>
        <div class="mt-3 p-field" *ngIf="selectedQueryType && selectedQueryType.key === CHARACTER">
          <label class="mr-3" for="character">{{"PAGE.CONCORDANCE.CHARACTER" | translate}}</label>
          <input id="character" type="text" pInputText style="width: 350px;" [(ngModel)]="character">
        </div>
        <div class="mt-3 p-field" *ngIf="selectedQueryType && selectedQueryType.key === CQL">
          <label class="mr-3" for="cql">{{"PAGE.CONCORDANCE.CQL" | translate}}</label>
          <input id="cql" type="text" pInputText style="width: 350px;" [(ngModel)]="cql">
          <label class="ml-3 mr-3">{{"PAGE.CONCORDANCE.DEFAULT_ATTRIBUTE" | translate}}</label>
          <p-dropdown [options]="defaultAttributeCQLList" [(ngModel)]="defaultAttributeCQL" [style]="{'width':'12rem'}">
            <ng-template let-option pTemplate="item">
              {{'PAGE.CONCORDANCE.' + option.value | translate}}
            </ng-template>
            <ng-template pTemplate="selectedItem" let-item>
              {{'PAGE.CONCORDANCE.' + item.value | translate}}
            </ng-template>
          </p-dropdown>
        </div>
      </div>

      <div class="mt-3" *ngIf="contextStatus">
        <app-context-concordance [contextConcordanceQueryRequest]="contextConcordanceQueryRequest">
        </app-context-concordance>
        <div class="flex justify-content-center mt-3">
          <button pButton type="button" icon="pi" label="{{'PAGE.CONCORDANCE.MAKE_CONCORDANCE' | translate}}"
            (click)="makeConcordances()" class="mr-3"></button>
          <button pButton type="button" icon="pi" label="{{'PAGE.CONCORDANCE.CLEAR_ALL' | translate}}"
            (click)="clickClearAll()"></button>
        </div>
      </div>
    </p-card>

    <div class="flex mt-3 w-12 justify-content-center" *ngIf="loading">
      <p-progressSpinner [style]="{width: '50px', height: '50px'}"></p-progressSpinner>
    </div>
    <div class="flex mt-3" *ngIf="resultView">
      <p-card class="w-12">
        <div class="">
          <div class="" style="width: 250px;">
            <h3 *ngIf="totalResults">Query <span style="color:red;">{{simpleResult}}</span>&nbsp;<b>{{totalResults}}</b>
            </h3>
          </div>
        </div>

        <!-- <app-kwic-lines-view [kwicLines]="kwicLines" [loadConcordances]="loadConcordances" [loading]="loading">
        </app-kwic-lines-view> -->

        <div class="" style="width: 150px;">
          <p-dialog header="{{'PAGE.CONCORDANCE.VIDEO' | translate}}" [(visible)]="displayModal"
            [style]="{width: '700'}" [baseZIndex]="10000">
            <iframe title="Video" style="border: 0px;" width="600" height="450" [src]="videoUrl" allow="autoplay"
              allowfullscreen></iframe>
          </p-dialog>
        </div>
        <p-table [value]="kwicLines" [lazy]="true" (onLazyLoad)="loadConcordances($event)" [paginator]="true"
          styleClass="p-datatable-striped" [rows]="10" [totalRecords]="totalResults" [loading]="loading"
          currentPageReportTemplate="'page: {currentPage} of {totalPages}'" [showCurrentPageReport]="true"
          [rowsPerPageOptions]="[10,25,50]">
          <ng-template pTemplate="header">
            <tr>
              <th style="width: 80px;"></th>
              <th class="p-text-center" style="width: 180px;">Left</th>
              <th class="p-text-center" style="width: 80px;">Kwic</th>
              <th class="p-text-center" style="width: 180px;">Right</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-kwicLine let-rowIndex="rowIndex">
            <tr>
              <td>
                <button pButton type="button" label="{{'PAGE.CONCORDANCE.VIDEO' | translate}}"
                  (click)="showVideoDlg(rowIndex)"></button>
              </td>
              <td class="p-text-right">{{kwicLine.leftContext}}</td>
              <td class="p-text-center">
                <p-button label="{{kwicLine.kwic}}" styleClass="p-button-link"
                  (click)="op.toggle($event); showDialog(kwicLine)"></p-button>
              </td>
              <td class="p-text-left">{{kwicLine.rightContext}}</td>
            </tr>
          </ng-template>
        </p-table>
        <p-overlayPanel #op [style]="{width: '450px'}">
          <ng-template pTemplate>
            <div>{{resultContext?.after}}</div>
            <div style="text-align: center; color: red;">
              {{resultContext?.keyword}}
            </div>
            <div>
              {{resultContext?.before}}
            </div>
          </ng-template>
        </p-overlayPanel>

      </p-card>
    </div>
    <div class="mt-3 w-12" *ngIf="!resultView && noResultFound && !loading">
      <p-card>
        <h3 style="text-align: center; color: red;">{{"PAGE.NO_RESULT_FOUND" | translate}}</h3>
      </p-card>
    </div>
  </div>

  <div class="flex w-6" *ngIf="displayPanelService.displayPanelMetadata || displayPanelService.displayPanelOptions">
    <app-dispaly-panel-options [isVisualQuery]="false" [selectedCorpus]="selectedCorpus"
      [metadataAttributes]="metadataAttributes" [textTypesAttributes]="textTypesAttributes"
      [metadataTextTypes]="metadataTextTypes">
    </app-dispaly-panel-options>
  </div>
</div>
